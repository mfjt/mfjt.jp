---
title: Fly.io に GoToSocial のおひとりさまインスタンスを立てた
date: 2023-01-02T00:00:00+09:00
archives:
  - 2023
  - 2023-01
aliases:
  - /diary/20230102.html
---
* 2017 年の第一次 Mastodon ブームの折にも自前でインスタンスを立ててみたものの、当時使っていたさくらの VPS ではあまりにも重すぎたのと、Mastodon を積極的に使う理由も無く「結局 Twitter でええやん」となり、すぐに使わなくなった
    * 余談だが、行儀の悪い方法でインスタンスを潰したせいか、当時の URI に対して未だにリクエストが来ているのが分かっ>たので、Cloudflare Workers で `410 Gone` を返すようにした
* 最近の Twitter のゴタゴタを受けても、個人的には思想的にどうのこうのという理由で積極的に脱 Twitter しようという感じではないものの、万が一・億が一レベルで物理的に Twitter が残るか怪しい雰囲気も出てきたことや、世間的に脱 Twitter が加速したときの準備をしようと思い、年末くらいから動き始めた
* Mastodon はおひとりさまインスタンスにはヘビーすぎるので Misskey を試したけど、なぜかリモートフォローができず詰まっていた
    * Cloudflare が悪さして Misskey までリクエストが届いていなかったりしたということはあったものの、その辺りを潰してもなお解消せずお手上げだった
* そうこうしているうちに[脱TwitterしたいのでMastodonに移行しつつ、gotosocialでオレオレサーバーを立ててみた](https://www.zukeran.org/shin/d/2022/12/22/my-own-gotosocial-server/)というエントリをはてブ経由か何かで見つけて、これ良さそうだなと思って試し始めた
* Misskey と同様、Docker で自前で動かしているとなぜかうまくいかなかったが、[Fly.io で動かす](https://the.kalaclista.com/echos/2022/11/26/133159/)という方法があることを知り Fly.io で試したら何となく上手く動き始めたっぽい
    * Fly.io、{{my '20221204#p01', 'この日記の引っ越しを検討したとき'}}にも存在は認知はしていたが禄に調べてなかった>けど、Dockerfile や Docker イメージを食わせれば何でも動くっぽいので、そのうちこの日記も移してしまいたい

といった経緯で [@mfjt@mfjt.jp](https://gts.mfjt.jp/@mfjt) でおひとりさまインスタンスを始めた。Twitter 自体、自ら発信するというよりは情報を拾うために使う傾向が強く、「今後は GoToSocial の方でばりばりやっていく」という気概も一切ないので、こっちはこっちでテキトーに使っていく。

「おま環」の可能性は否めないけど、Fly.io で詰まった点がいくつかあるのでメモ。

* `flyctl` を打っても反応が無かったり、著しく反応が遅いことがある
    * 特定のコマンドに限らず発生する
    * 未だに解消はしておらず、再実行を繰り返すしか対処しようがないが、今後は GoToSocial のバージョンアップ時の再デプロイくらいでしか使わないだろうから目をつぶることにする
* CNAME レコードで独自ドメインを設定すると、Cloudflare でプロキシできなかったり、なぜか繋がらない・通信が詰まる感じ>になることがある
    * Cloudflare でプロキシできない件については、ググって出てきた Fly.io のフォーラムの情報などを見る限りでは「プロ>キシさせるな」が答えのように見受けられたので大人しくそうした
    * プロキシさせないことで「なぜか全く繋がらない」という事象が一旦は解消できたと思われたが、それでもタイミングによっては繋がらなかったり、フン詰まるということが発生していた。これについては、当てずっぽうで A レコード (と AAAA レコ>ード) に変えてみたら綺麗に解消した
    * また (これも理由はよく分からないけど)、副次的に Cloudflare でプロキシさせても問題なくなったので、画像ファイル>等のストレージである S3 に対するリクエストを減らすことができた (はず)
